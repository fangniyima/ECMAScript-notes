è¯·å‚é˜…é€šç”¨è¿­ä»£æ¥å£(26.1)

### 7.4.1 GetIterator ( obj [ , hint [ , method ] ] )

æŠ½è±¡æ“ä½œGetIteratoræ¥å—å‚æ•°objä»¥åŠå¯é€‰å‚æ•°çš„æç¤ºå’Œæ–¹æ³•ã€‚ è°ƒç”¨æ—¶ï¼Œå®ƒå°†æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    1.If hint is not present, set hint to sync.
    2.Assert: hint is either sync or async.
    3.If method is not present, then
        If hint is async, then
            Set method to ? GetMethod(obj, @@asyncIterator).
            If method is undefined, then
                Let syncMethod be ? GetMethod(obj, @@iterator).
                Let syncIteratorRecord be ? GetIterator(obj, sync, syncMethod).
                Return ! CreateAsyncFromSyncIterator(syncIteratorRecord).
        Otherwise, set method to ? GetMethod(obj, @@iterator).
    4.Let iterator be ? Call(method, obj).
    5.If Type(iterator) is not Object, throw a TypeError exception.
    6.Let nextMethod be ? GetV(iterator, "next").
    7.Let iteratorRecord be the Record { [[Iterator]]: iterator, [[NextMethod]]: nextMethod, [[Done]]: false }.
    8.Return iteratorRecord.

### 7.4.2 IteratorNext ( iteratorRecord [ , value ] )

æŠ½è±¡æ“ä½œIteratorNextæ¥å—å‚æ•°iteratorRecordå’Œå¯é€‰å‚æ•°å€¼ã€‚ è°ƒç”¨æ—¶ï¼Œå®ƒå°†æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    1.If value is not present, then
        Let result be ? Call(iteratorRecord.[[NextMethod]], iteratorRecord.[[Iterator]]).
    2.Else,
        Let result be ? Call(iteratorRecord.[[NextMethod]], iteratorRecord.[[Iterator]], Â« value Â»).
    3.If Type(result) is not Object, throw a TypeError exception.
    4.Return result.

### 7.4.3 IteratorComplete ( iterResult )

æŠ½è±¡æ“ä½œIteratorCompleteæ¥å—å‚æ•°iterResultã€‚å®ƒåœ¨è°ƒç”¨æ—¶æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    1.Assert: Type(iterResult) is Object.
    2.Return ! ToBoolean(? Get(iterResult, "done")).

### 7.4.4 IteratorValue ( iterResult )

æŠ½è±¡æ“ä½œIteratorValueæ¥å—å‚æ•°iterResultã€‚å®ƒåœ¨è°ƒç”¨æ—¶æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    1.Assert: Type(iterResult) is Object.
    2.Return ? Get(iterResult, "value").

### 7.4.5 IteratorStep ( iteratorRecord )

æŠ½è±¡æ“ä½œIteratorStepæ¥å—å‚æ•°iteratorRecordã€‚å®ƒé€šè¿‡è°ƒç”¨iteratorRecordã€‚[[NextMethod]]ä»iteratorRecordã€‚[[Iterator]]è¯·æ±‚ä¸‹ä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›falseï¼Œè¡¨ç¤ºè¿­ä»£å™¨å·²åˆ°è¾¾å…¶ç»“å°¾ï¼Œå¦‚æœä¸‹ä¸€ä¸ªå€¼å¯ç”¨ï¼Œåˆ™è¿”å›IteratorResultå¯¹è±¡ã€‚å®ƒåœ¨è°ƒç”¨æ—¶æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    1.Let result be ? IteratorNext(iteratorRecord).
    2.Let done be ? IteratorComplete(result).
    3.If done is true, return false.
    4.Return result.

### 7.4.6 IteratorClose ( iteratorRecord, completion )

æŠ½è±¡æ“ä½œIteratorCloseæ¥å—iteratorRecordå’Œcompletionå‚æ•°ã€‚å®ƒç”¨äºé€šçŸ¥è¿­ä»£å™¨ï¼Œå½“å®ƒè¾¾åˆ°å®ŒæˆçŠ¶æ€æ—¶ï¼Œå®ƒåº”è¯¥æ‰§è¡Œå®ƒé€šå¸¸ä¼šæ‰§è¡Œçš„ä»»ä½•æ“ä½œã€‚å®ƒåœ¨è°ƒç”¨æ—¶æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    1.Assert: Type(iteratorRecord.[[Iterator]]) is Object.
    2.Assert: completion is a Completion Record.
    3.Let iterator be iteratorRecord.[[Iterator]].
    4.Let innerResult be GetMethod(iterator, "return").
    5.If innerResult.[[Type]] is normal, then
        Let return be innerResult.[[Value]].
        If return is undefined, return Completion(completion).
        Set innerResult to Call(return, iterator).
    6.If completion.[[Type]] is throw, return Completion(completion).
    7.If innerResult.[[Type]] is throw, return Completion(innerResult).
    If Type(innerResult.[[Value]]) is not Object, throw a TypeError exception.
    9.Return Completion(completion).

### 7.4.7 AsyncIteratorClose ( iteratorRecord, completion )

æŠ½è±¡æ“ä½œAsyncIteratorCloseæ¥å—iteratorRecordå’Œcompletionå‚æ•°ã€‚å®ƒç”¨äºé€šçŸ¥å¼‚æ­¥è¿­ä»£å™¨ï¼Œå½“å®ƒè¾¾åˆ°å®ŒæˆçŠ¶æ€æ—¶ï¼Œå®ƒåº”è¯¥æ‰§è¡Œå®ƒé€šå¸¸ä¼šæ‰§è¡Œçš„ä»»ä½•æ“ä½œã€‚å®ƒåœ¨è°ƒç”¨æ—¶æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    1.Assert: Type(iteratorRecord.[[Iterator]]) is Object.
    2.Assert: completion is a Completion Record.
    3.Let iterator be iteratorRecord.[[Iterator]].
    4.Let innerResult be GetMethod(iterator, "return").
    5.If innerResult.[[Type]] is normal, then
        Let return be innerResult.[[Value]].
        If return is undefined, return Completion(completion).
        Set innerResult to Call(return, iterator).
        If innerResult.[[Type]] is normal, set innerResult to Await(innerResult.[[Value]]).
    6.If completion.[[Type]] is throw, return Completion(completion).
    7.If innerResult.[[Type]] is throw, return Completion(innerResult).
    8.If Type(innerResult.[[Value]]) is not Object, throw a TypeError exception.
    9.Return Completion(completion).

### 7.4.8 CreateIterResultObject ( value, done )

æŠ½è±¡æ“ä½œCreateIterResultObjectæ¥å—å‚æ•°valueå’Œdoneã€‚ å®ƒåˆ›å»ºä¸€ä¸ªæ”¯æŒIteratorResultæ¥å£çš„å¯¹è±¡ã€‚ è°ƒç”¨æ—¶ï¼Œå®ƒå°†æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    1.Assert: Type(done) is Boolean.
    2.Let obj be ! OrdinaryObjectCreate(%Object.prototype%).
    3.Perform ! CreateDataPropertyOrThrow(obj, "value", value).
    4.Perform ! CreateDataPropertyOrThrow(obj, "done", done).
    5.Return obj.

### 7.4.9 CreateListIteratorRecord ( list )

æŠ½è±¡æ“ä½œCreateListIteratorRecordæ¥å—å‚æ•°åˆ—è¡¨ã€‚å®ƒåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼ˆ26.1.1.2ï¼‰å¯¹è±¡è®°å½•ï¼Œå…¶ä¸‹ä¸€ä¸ªæ–¹æ³•è¿”å›listçš„è¿ç»­å…ƒç´ ã€‚å®ƒåœ¨è°ƒç”¨æ—¶æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    1.Let iterator be ! OrdinaryObjectCreate(%IteratorPrototype%, Â« [[IteratedList]], [[ListNextIndex]] Â»).
    2.Set iterator.[[IteratedList]] to list.
    3.Set iterator.[[ListNextIndex]] to 0.
    4.Let steps be the algorithm steps defined in ListIteratorNext Functions.
    5.Let next be ! CreateBuiltinFunction(steps, Â« Â»).
    6.Return Record { [[Iterator]]: iterator, [[NextMethod]]: next, [[Done]]: false }.

æ³¨æ„

åˆ—è¡¨è¿­ä»£å™¨å¯¹è±¡æ°¸è¿œä¸èƒ½è¢«ECMAScriptä»£ç ç›´æ¥è®¿é—®ã€‚

#### 7.4.9.1 ListIteratorNext Functions

ListIteratorNextå‡½æ•°æ˜¯åŒ¿åå†…ç½®å‡½æ•°ã€‚ å½“ä¸å¸¦ä»»ä½•å‚æ•°è°ƒç”¨æ—¶ï¼Œå®ƒå°†æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    Let O be the this value.
    Assert: Type(O) is Object.
    Assert: O has an [[IteratedList]] internal slot.
    Let list be O.[[IteratedList]].
    Let index be O.[[ListNextIndex]].
    Let len be the number of elements of list.
    If index â‰¥ len, then
        Return CreateIterResultObject(undefined, true).
    Set O.[[ListNextIndex]] to index + 1.
    Return CreateIterResultObject(list[index], false).


ListIteratorNextå‡½æ•°çš„â€œ lengthâ€å±æ€§ä¸º+0ğ”½ã€‚

### 7.4.10 IterableToList ( items [ , method ] )

æŠ½è±¡æ“ä½œIterableToListå…·æœ‰å‚æ•°é¡¹å’Œå¯é€‰çš„å‚æ•°æ–¹æ³•ã€‚ è°ƒç”¨æ—¶ï¼Œå®ƒå°†æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    If method is present, then
        Let iteratorRecord be ? GetIterator(items, sync, method).
    Else,
        Let iteratorRecord be ? GetIterator(items, sync).
    Let values be a new empty List.
    Let next be true.
    Repeat, while next is not false,
        Set next to ? IteratorStep(iteratorRecord).
        If next is not false, then
            Let nextValue be ? IteratorValue(next).
            Append nextValue to the end of the List values.
    Return values.